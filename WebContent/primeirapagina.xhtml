<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui = "http://java.sun.com/jsf/facelets"
	xmlns:pt = "http://xmlns.jcp.org/jsf/passthrough">
	<!-- tag ui do jsf para trabalhar com templates da página, com includes de páginas por ex. -->

<h:head>
	<title>Cadastro de Usuário</title>
</h:head>

<h:body>
	
	<ui:include src="/menu.xhtml"/> <!-- inclusão do xhtml do menu que se repete em todas as páginas -->

	<!-- o jsf consegue localizar automaticamente uma pasta com o padrão de nome = resources, com isso não é necessário
	declarar a imagem no componente da forma comum: <h:graphicImage value="/resources/img/logojsf1.png" height="100" width="100" /> e sim da forma abaixo,
	informando somente o nome da subpasta img e o nome do arquivo -->
	<h:graphicImage library="img" name="logojsf1.png" height="100" width="100"/>
	<h:form id="formPessoa" rendered="#{pessoaBean.permiteAcesso('ADMINISTRADOR')}">
	
		<h:messages/> <!-- compenente que exibe mensagens JSF (método definido no PessoaBean) -->
		
		<h:panelGrid columns="2">
			<f:facet name="header">
				<h:outputText value="Cadastro de Usuário"/>
			</f:facet>
			<h:outputLabel value="ID: "/>
			<h:outputText value="#{pessoaBean.pessoa.id}"/>
			<h:outputLabel value="Nome: " />
			<h:inputText value="#{pessoaBean.pessoa.nome}" required="true" requiredMessage="Informe o nome do usuário" validatorMessage="Nome tem que ter no minimo 10 e no máximo 50 chars"
			pt:placeholder="Primeiro Nome">
				<f:validateLength minimum="10" maximum="50"/><!-- Validador de tamanho de string -->
			</h:inputText>
			<h:outputLabel value="Sobrenome: " />
			<h:inputText value="#{pessoaBean.pessoa.sobrenome}" />
			<h:outputLabel value="Idade: " />
			<h:inputText value="#{pessoaBean.pessoa.idade}" />
			
			<h:outputLabel value="Sexo" />
			<h:selectOneMenu id="campoSexo" value="#{pessoaBean.pessoa.sexo}">
				<f:selectItem itemValue="Masculino" itemLabel="Sexo Masculino"/>
				<f:selectItem itemValue="Feminino" itemLabel="Sexo Feminino"/>
			</h:selectOneMenu>
			
			<h:outputLabel value="Data de Nascimento:" />
			<h:inputText value="#{pessoaBean.pessoa.dataNascimento}" converterMessage="Data de nascimento inválida!"> <!-- O converterMessage exibe a mensagem caso o 
			pattern da tag converterDataTime não seja respeitado -->
				<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR" timeZone="GMT-03:00"/> <!-- componente jsf que converte e formata datas. 
				Importante configurar o locale e timezone para não dar erros nas datas -->
			</h:inputText>
			
			
			<h:outputLabel value="Frameworks" />
			<h:selectManyMenu id="campoFrameworks" value="#{pessoaBean.pessoa.frameworks}" style="height:150px">
				<f:selectItem itemValue="Hibernate"/>
				<f:selectItem itemValue="Spring MVC"/>
				<f:selectItem itemValue="JPA"/>
				<f:selectItem itemValue="Primefaces"/>
				<f:selectItem itemValue="JSF"/>
			</h:selectManyMenu>
			
			<h:outputLabel value="CEP: " />
			<h:inputText value="#{pessoaBean.pessoa.cep}">
				<f:ajax event="blur" execute="@this" listener="#{pessoaBean.pesquisaCep}"
				render="logradouro complemento bairro localidade uf unidade ibge gia"/> <!-- O ajax sará executado no evento de perda de foco, no caso do JSF é o blur
				. A ação será no próprio compenente do inputText (this).
				O listener vai ser o método que será executado para consultar o CEP, com o valor do inputText(@this)
				Já o render é o atributo que marca os componentes que serão recarregados pelo Ajax com os novos dados, esses compenentes nesse caso precisam de um id decalro que será informado no
				atributo render(no caso todos os campos do endereço) -->
			</h:inputText>
			
			<h:outputLabel value="Logradouro"/>
			<h:inputText value="#{pessoaBean.pessoa.logradouro}" id="logradouro"/>
			<h:outputLabel value="Complemento"/>
			<h:inputText value="#{pessoaBean.pessoa.complemento}" id="complemento"/>
			<h:outputLabel value="Bairro"/>
			<h:inputText value="#{pessoaBean.pessoa.bairro}" id="bairro"/>
			<h:outputLabel value="Localidade"/>
			<h:inputText value="#{pessoaBean.pessoa.localidade}" id="localidade"/>
			<h:outputLabel value="Estado" />
			<h:inputText value="#{pessoaBean.pessoa.uf}" id="uf"/>
			<h:outputLabel value="Unidade" />
			<h:inputText value="#{pessoaBean.pessoa.unidade}" id="unidade"/>
			<h:outputLabel value="IBGE" />
			<h:inputText value="#{pessoaBean.pessoa.ibge}" id="ibge" />
			<h:outputLabel value="GIA" />
			<h:inputText value="#{pessoaBean.pessoa.gia}" id="gia" />
			
			<h:outputLabel value="Ativo:" />
			<h:selectBooleanCheckbox value="#{pessoaBean.pessoa.ativo}" />
			
			<h:outputLabel value="Login"/>
			<h:inputText value="#{pessoaBean.pessoa.login}"/>
			
			<h:outputLabel value="Senha"/>
			<h:inputSecret value="#{pessoaBean.pessoa.senha}"/>
			
			<h:outputLabel value="Perfil" />
			<h:selectOneMenu id="campoPerfil" value="#{pessoaBean.pessoa.perfilUser}">
				<f:selectItem itemValue="ADMINISTRADOR" itemLabel="Administrador"/>
				<f:selectItem itemValue="SECRETARIO" itemLabel="Secretario"/>
				<f:selectItem itemValue="RECEPCIONISTA" itemLabel="Recepcioninsta"/>
			</h:selectOneMenu>
			
			<h:outputLabel value="Nivel de Programador: "/>
			<h:selectOneRadio value="#{pessoaBean.pessoa.nivelProgramador}" layout="pageDirection">
				<f:selectItem itemValue="J" itemLabel="Junior"/>
				<f:selectItem itemValue="P" itemLabel="Pleno"/>
				<f:selectItem itemValue="S" itemLabel="Senior"/>
				<f:selectItem itemValue="E" itemLabel="Expecialista"/>
			</h:selectOneRadio>
			
			<h:outputLabel value="Linguagens:" />
			<h:selectManyCheckbox value="#{pessoaBean.pessoa.linguagens}">
				<f:selectItem itemValue="1" itemLabel="Java"/>
				<f:selectItem itemValue="2" itemLabel="PHP"/>
				<f:selectItem itemValue="3" itemLabel="Pyton"/>
				<f:selectItem itemValue="4" itemLabel="C#"/>
				<f:selectItem itemValue="5" itemLabel="Cobol"/>
			</h:selectManyCheckbox>
			
			<h:outputLabel value="Estados: " />
			<h:selectOneMenu value="#{pessoaBean.pessoa.estados}" immediate="true" > <!-- obejto que irá receber a seleção da tela, o param immediate faz o compeonte sem enviado sem passar por validações como as dos formulários -->
				<!-- Definindo a primeira oppção do combo, e setando ela como não valida para a seleção -->
				<f:selectItem itemLabel="--[Selecione]--" noSelectionOption="true" />
				<!-- Carregamento da lista de seleção do BD -->
				<f:selectItems value="#{pessoaBean.estados}" />
				<!-- Dispara o ajax quando houver uma troca(selecção de um estado) enviando apenas o valor desse componente e eexecuta o método carregarCidades -->
				<f:ajax event="change" execute="@this" listener="#{pessoaBean.carregarCidades}" render="comboCidade" />
			</h:selectOneMenu>
			
			<h:outputLabel value="Cidades:  "/>
			<h:selectOneMenu value="#{pessoaBean.pessoa.cidades}" id="comboCidade">
			<f:selectItem noSelectionOption="true" itemLabel="--[Selecione]--" />
				<f:selectItems value="#{pessoaBean.cidades}" />
			</h:selectOneMenu>
			
			<h:outputLabel/>
			<h:panelGroup>
				<h:commandButton id="botaoNovo" value="Novo" action="#{pessoaBean.novo}" image="/resources/img/new-user.png">
					<f:ajax execute="botaoNovo" render="@form" /> <!-- Requisição ajax, executa o botão de novo, preenchendo o managed bean e renderizando no formulário as informções -->
				</h:commandButton>
				<h:commandButton value="Salvar" action="#{pessoaBean.salvar}" image="/resources/img/save.png"/>
				<h:commandButton value="Deletar" action="#{pessoaBean.remove}" image="/resources/img/delete.png"/>
				<h:commandButton id="botaoLimpar" value="Limpar" action="#{pessoaBean.limpar}">
					<f:ajax execute="botaoLimpar" render="@form" />
				</h:commandButton>
			</h:panelGroup>
		</h:panelGrid>
				
	</h:form >
		<!-- datatable ira carregar os dados de pessoas -->
		<h:form id="formTable">
			<h:dataTable value="#{pessoaBean.pessoas}" var="pessoa" border="3" cellpadding="6">
				<f:facet name="header">
					<h:outputText value="Lista de Usuários Cadastradas"/>
				</f:facet>
				<h:column>
					<f:facet name="header">ID</f:facet>
					<h:outputText value="#{pessoa.id}" />
				</h:column>
				<h:column>
					<f:facet name="header">Nome</f:facet>
					<h:outputText value="#{pessoa.nome}" />
				</h:column>
				<h:column>
					<f:facet name="header">Sobrenome</f:facet>
					<h:outputText value="#{pessoa.sobrenome}" />
				</h:column>
				<h:column rendered="#{pessoaBean.permiteAcesso('ADMINISTRADOR')}"> <!-- Verificação, somente em perfil adiminitrador que esse componente estará visivel. -->
					<f:facet name="header">Ação</f:facet>
					<h:commandLink >
						<f:setPropertyActionListener value="#{pessoa}" target="#{pessoaBean.pessoa}" /> <!-- Atribui o objeto pessoa, que está na linha da tabela, para o managedbean -->
						<h:graphicImage value="/resources/img/edit.png" title="Editar"/>
					</h:commandLink>
					<h:outputLabel value=" | " />
					<h:commandLink  action="#{pessoaBean.remove}">
						<f:setPropertyActionListener value="#{pessoa}" target="#{pessoaBean.pessoa}" /> <!-- O processo é o memso do link anterior , com a difenreça que há um action que irá enviar a ação a ser executada para o managed bean -->
						<h:graphicImage value="/resources/img/delete.png" title="Excluir"/>
					</h:commandLink>
				</h:column>
			</h:dataTable>
		</h:form>

</h:body>



</html>